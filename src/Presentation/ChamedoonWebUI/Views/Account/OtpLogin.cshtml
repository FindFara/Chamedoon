@{
    ViewData["Title"] = "ورود با رمز یکبار مصرف";
    Layout = "~/Views/Shared/AuthLayout.cshtml";
}

<section class="glass-section auth-section login-centered">
    <div class="auth-card-shell">
        <div class="auth-card auth-card-simple text-center">
            <div class="auth-card-header text-center">
                <h2>ورود با رمز یکبار مصرف</h2>
                <p class="auth-subtitle">کد یکبار مصرف را با ایمیلت دریافت کن</p>
            </div>
            <form class="otp-form" novalidate>
                <div class="glass-field" id="otpEmailWrapper">
                    <label for="otpEmail" class="form-label text-end w-100">ایمیل</label>
                    <input id="otpEmail" type="email" class="form-control glass-input" placeholder="example@mail.com" required />
                    <span class="text-danger small d-none" id="otpEmailError">لطفا یک ایمیل معتبر وارد کن.</span>
                </div>
                <div class="glass-field d-none" id="otpCodeWrapper">
                    <label for="otpCode" class="form-label text-end w-100">کد چهار رقمی</label>
                    <input id="otpCode" type="text" inputmode="numeric" maxlength="4" class="form-control glass-input" placeholder="OTP-کد" />
                    <p class="glass-helper mb-0">کد ارسال شده به ایمیلت را وارد کن.</p>
                </div>
                <div class="text-danger small d-none" id="otpStatus"></div>
                <button type="button" class="btn-auth-primary w-100" id="otpContinue">ادامه</button>
            </form>
            <div class="auth-meta text-center">
                <a asp-controller="Account" asp-action="Login" class="auth-otp-link">بازگشت به ورود با رمز عبور</a>
            </div>
        </div>
    </div>
</section>

@section Scripts {
    <script>
        document.addEventListener('DOMContentLoaded', function () {
            const emailInput = document.getElementById('otpEmail');
            const codeInput = document.getElementById('otpCode');
            const emailWrapper = document.getElementById('otpEmailWrapper');
            const codeWrapper = document.getElementById('otpCodeWrapper');
            const continueButton = document.getElementById('otpContinue');
            const emailError = document.getElementById('otpEmailError');
            const statusMessage = document.getElementById('otpStatus');

            let codeRequested = false;

            continueButton.addEventListener('click', function () {
                if (!codeRequested) {
                    const emailValue = emailInput.value.trim();
                    const isValidEmail = /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(emailValue);

                    if (!isValidEmail) {
                        emailError.classList.remove('d-none');
                        statusMessage.classList.add('d-none');
                        return;
                    }

                    emailError.classList.add('d-none');
                    statusMessage.textContent = 'کد ورود برای ایمیل وارد شده ارسال شد.';
                    statusMessage.classList.remove('d-none');
                    emailWrapper.classList.add('d-none');
                    codeWrapper.classList.remove('d-none');
                    continueButton.textContent = 'تایید کد';
                    codeRequested = true;
                    codeInput.focus();
                } else {
                    statusMessage.textContent = 'کد وارد شده ثبت شد.';
                    statusMessage.classList.remove('d-none');
                }
            });
        });
    </script>
}
