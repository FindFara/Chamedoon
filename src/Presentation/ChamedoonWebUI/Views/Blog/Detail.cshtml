@model Chamedoon.Application.Services.Blog.ViewModel.ArticleViewModel
@using System
@using System.Globalization
@using ChamedoonWebUI.Models
@{
    ViewData["Title"] = Model.ArticleTitle;
    var culture = CultureInfo.GetCultureInfo("fa-IR");
    var detailPath = Url.Action("Detail", "Blog", new { id = Model.Id }) ?? "#";
    var shareUrl = Url.Action("Detail", "Blog", new { id = Model.Id }, Context.Request.Scheme);
    var metaModel = new BlogArticleMetaModel
    {
        Writer = Model.Writer ?? string.Empty,
        VisitCountText = Model.VisitCount.ToString("N0", culture),
        VisitLabel = "تعداد بازدید",
        ShareUrl = shareUrl ?? detailPath,
        ShareTitle = Model.ArticleTitle,
        ShareText = Model.ShortDescription
    };
    var searchModel = new BlogSearchFormModel
    {
        FormIdPrefix = "blogDetail",
        Action = "Index",
        Controller = "Blog",
        SubmitLabel = "جستجوی مقالات",
        SubmitButtonClass = "btn-glass-primary",
        KeywordPlaceholder = "عنوان یا متن مقاله...",
        WriterPlaceholder = "نام نویسنده"
    };
    Func<string?, string> resolveArticleImage = imageName =>
    {
        if (string.IsNullOrWhiteSpace(imageName))
        {
            return Url.Content("~/images/blog/01.jpg");
        }

        var trimmed = imageName.Trim();

        if (Uri.TryCreate(trimmed, UriKind.Absolute, out _))
        {
            return trimmed;
        }

        trimmed = trimmed.TrimStart('~').TrimStart('/');

        if (trimmed.Contains("/"))
        {
            return Url.Content($"~/{trimmed}");
        }

        return Url.Content($"~/images/blog/{trimmed}");
    };
}

<section class="glass-section">
    <div class="container">
        <article class="glass-card blog-detail-card mb-4">
            <div class="blog-detail-header">
                <img src="@resolveArticleImage(Model.ArticleImageName)" alt="@Model.ArticleTitle" />
                <div>
                    <h1 class="fw-bold">@Model.ArticleTitle</h1>
                    <partial name="Partials/_ArticleMeta" model="metaModel" />
                </div>
            </div>
            <p class="glass-helper mb-0">@Model.ShortDescription</p>
        </article>

        <div class="glass-card blog-detail-search">
            <h5 class="fw-semibold mb-3">جستجوی سایر مقالات</h5>
            <partial name="Partials/_SearchForm" model="searchModel" />
        </div>
    </div>
</section>

@section Styles {
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@majidh1/jalalidatepicker/dist/jalalidatepicker.min.css" integrity="sha384-G7oizPQ+fPyA9xx0ScE6rKsn7BNQYXT33yHuEq+nCgtgK6IqKsZN1OtNLkwKo6k6" crossorigin="anonymous" />
    <link rel="stylesheet" href="~/css/blog/detail.css" asp-append-version="true" />
    <link rel="stylesheet" href="~/css/blog/meta.css" asp-append-version="true" />
    <link rel="stylesheet" href="~/css/blog/search.css" asp-append-version="true" />
    <link rel="stylesheet" href="~/css/components/datepicker.css" asp-append-version="true" />
}

@section Scripts {
    <script src="https://cdn.jsdelivr.net/npm/@majidh1/jalalidatepicker/dist/jalalidatepicker.min.js" integrity="sha384-Z3cr0UyAeMZZpMzQy51VCZHKktHG5bBg8TsFSxKxBd9Mu+m6nH2MA0/QRPq1aEQJ" crossorigin="anonymous"></script>
    <script src="~/js/components/jalali-datepicker.js" asp-append-version="true"></script>
    <script src="~/js/blog/share.js" asp-append-version="true"></script>
}
